<!DOCTYPE html>
<html lang="ch" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Insert title here</title>
    <link th:href="@{/favicon.ico}" rel="shortcut icon"/>
    <link th:href="@{/css/bootstrap.min.css?v=3.3.6}" rel="stylesheet"/>
    <link th:href="@{/css/font-awesome.css?v=4.4.0}" rel="stylesheet"/>
    <link th:href="@{/css/plugins/iCheck/custom.css}" rel="stylesheet"/>
    <link th:href="@{/css/animate.css}" rel="stylesheet}"/>
    <link
            th:href="@{/css/multiple-select.min.css}"
            rel="stylesheet"
            type="text/css"
    />
    <link th:href="@{/css/bootstrap.min.css?v=3.3.6}" rel="stylesheet"/>
    <link th:href="@{/css/plugins/chosen/chosen.css}" rel="stylesheet"/>
    <link th:href="@{/css/GA.css}" rel="stylesheet" type="text/css"/>
    <link th:href="@{/css/style.css?v=4.1.0}" rel="stylesheet"/>
    <link
            th:href="@{/css/plugins/bootstrap-table/bootstrap-table.min.css}"
            rel="stylesheet"
    />
    <link th:href="@{/css/GA.css}" rel="stylesheet"/>
    <!-- 全局js -->
    <script th:src="@{/js/jquery.min.js?v=2.1.4}"></script>
    <script th:src="@{/js/bootstrap.min.js?v=3.3.6}"></script>
    <script th:src="@{/js/xlsx.full.min.js}"></script>
    <script th:src="@{/js/plugins/chosen/chosen.jquery.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>
    <script th:src="@{/js/echarts.min.js}"></script>

    <!-- Bootstrap table -->
    <script th:src="@{/js/plugins/bootstrap-table/bootstrap-table.min.js}"></script>
    <script th:src="@{/js/plugins/bootstrap-table/bootstrap-table-mobile.min.js}"></script>
    <script th:src="@{/js/plugins/bootstrap-table/locale/bootstrap-table-zh-CN.min.js}"></script>
    <!--    datatables-->
    <link th:href="@{/css/plugins/dataTables/dataTables.bootstrap.css}" rel="stylesheet">
    <script th:src="@{/js/plugins/jeditable/jquery.jeditable.js}"></script>

    <!-- Data Tables -->
    <script th:src="@{/js/plugins/dataTables/jquery.dataTables.js}"></script>
    <script th:src="@{/js/plugins/dataTables/dataTables.bootstrap.js}"></script>

    <!-- Peity -->
    <script th:src="@{/js/plugins/peity/jquery.peity.min.js}"></script>
    <script th:src="@{/js/plugins/layer/layer.min.js}"></script>
    <script th:src="@{/js/multiple-select.min.js}"></script>
    <!--    用于处理csv-->
    <script th:src="@{https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js}"></script>

    <!-- 自定义js -->
    <script th:src="@{/js/content.js?v=1.0.0}"></script>
    <script type="text/javascript">
        let defaultOption = "onlinepayment_low";
        let sheet = "";
        let suffix = "";
        let sceneName = "";
        document.addEventListener('DOMContentLoaded', function () {
            fetch('/toolset/getDefaultSelection?toolsetName=' + 'excel')
                .then(response => {
                    if (response.ok) {
                        return response.json();
                    } else {
                        throw new Error('Failed to fetch');
                    }
                })
                .then(data => {
                    if (data.code === 200 && data.message) {
                        defaultOption = data.data;
                        console.log("defaultOption: " + defaultOption);
                        setDefaultOption(defaultOption)

                    } else {
                        setDefaultOption(defaultOption);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert("获取默认算法失败");
                    setDefaultOption(defaultOption);
                });


        });

        function setDefaultOption(value) {
            let selecteTemplate = document.getElementById("choose_template_sheet");
            let selectTranferScene = document.getElementById("choose_transfer_scene");
            const parts = value.split("_");
            const templateName = parts.slice(0, -1).join("_");
            console.log("sceneName: " + templateName);
            const transferScene = parts.slice(-1);
            console.log("transferScene: " + transferScene);

            selecteTemplate.value = templateName;
            selectTranferScene.value = transferScene;
            sheet = templateName;
            suffix = "_" + transferScene;
            sceneName = sheet + suffix;
        }

        window.onload = function () {
            const fieldTypeOptions = {
                0: "数值型数据",
                1: "编码型数据",
                3: "文本型数据",
                4: "时间数据"
            };

            const typeFieldOptions = {
                "数值型数据": 0,
                "编码型数据": 1,
                "文本型数据": 3,
                "时间数据": 4
            };

            const privacyProtectionLevels = {
                0: "无隐私保护处理",
                1: "低程度",
                2: "中程度",
                3: "高程度"
            };

            const desensitizationAlgorithms = {
                0: [
                    {value: 3, label: "基于拉普拉斯差分隐私的数值加噪算法"},
                    {value: 5, label: "基于随机均匀噪声的数值加噪算法"},
                    {value: 6, label: "基于随机拉普拉斯噪声的数值加噪算法"},
                    {value: 7, label: "基于随机高斯噪声的数值加噪算法"},
                    {value: 8, label: "数值偏移"},
                    {value: 9, label: "数值取整"},
                    {value: 10, label: "数值映射"}
                ],
                1: [{value: 2, label: "编码型数据差分隐私脱敏算法"}],
                3: [
                    {value: 11, label: "尾部截断"},
                    {value: 13, label: "邮箱抑制算法"},
                    {value: 14, label: "地址抑制算法"},
                    {value: 15, label: "名称抑制算法"},
                    {value: 16, label: "编号抑制算法"},
                    {value: 17, label: "假名化-哈希算法"},
                    {value: 19, label: "密码随机置换"},
                    {value: 20, label: "数值替换"},
                    {value: 21, label: "IP地址全抑制"},
                    {value: 22, label: "IP地址随机抑制"}
                ],
                4: [
                    {value: 1, label: "基于差分隐私的日期加噪算法"},
                    {value: 18, label: "日期分组置换"}
                ]
            };

            // 用于生成场景模板的表格
            function generateTable(data, headers, ifAll = true) {
                // 创建表格元素
                let $table = $("<table></table>").addClass("table table-striped").attr("id", "table2");

                // 创建表头
                let $thead = $("<thead></thead>");
                let $headerRow = $("<tr></tr>");
                headers.forEach(header => {
                    $headerRow.append($("<th></th>").text(header));
                });
                $thead.append($headerRow);

                // 创建表体
                let $tbody = $("<tbody></tbody>");
                data.forEach((item, index) => {
                    let $row = $("<tr></tr>").attr("id", `row_${index}`);
                    $row.append($("<td></td>").text(item.id)); // 编号
                    $row.append($("<td></td>").text(item.fieldName)); // 字段缩写
                    $row.append($("<td></td>").text(item.columnName)); // 字段名
                    $row.append($("<td></td>").text(getFieldType(item.dataType))); // 字段类型

                    if (ifAll) {
                        let $algorithmSelect = $("<select></select>");
                        if (desensitizationAlgorithms[item.dataType]) {
                            desensitizationAlgorithms[item.dataType].forEach(algorithm => {
                                let $option = $("<option></option>")
                                    .val(algorithm.value)
                                    .text(algorithm.label);
                                if (algorithm.value === item.k) $option.attr("selected", "selected");
                                $algorithmSelect.append($option);
                            });
                        }
                        $row.append($("<td></td>").append($algorithmSelect));

                        // 创建“隐私保护等级”列的 <select> 下拉框
                        let $privacySelect = $("<select></select>");
                        // Object.keys(privacyProtectionLevels).forEach(level => {
                        //     let $option = $("<option></option>")
                        //         .val(level)
                        //         .text(privacyProtectionLevels[level]);
                        //     if (parseInt(level) === item.tmParam) $option.attr("selected", "selected");
                        //     $privacySelect.append($option);
                        // });
                        Object.keys(privacyProtectionLevels).forEach(level => {
                            let $option = $("<option></option>")
                                .val(level)
                                .text(privacyProtectionLevels[level]);
                            if (parseInt(level) === item.tmParam) {
                                $option.attr("selected", "selected");
                            }
                            $privacySelect.append($option);
                        })
                        $row.append($("<td></td>").append($privacySelect));
                    }


                    // 如果需要额外的列，可以在此处继续添加
                    /*
                    $row.append($("<td></td>").text(getDesensitizationAlgorithm(item.k))); // 脱敏算法
                    $row.append($("<td></td>").text(getPrivacyProtectionLevel(item.tmParam))); // 隐私保护等级
                    */
                    $tbody.append($row);
                });
                // 将表头和表体添加到表格中
                $table.append($thead).append($tbody);

                return $table;
            }

            // 获取字段类型的显示文本
            function getFieldType(dataType) {
                return fieldTypeOptions[dataType] || "未知类型";
            }

            let selectedFile; // 全局变量，用于存储选择的文件
            let currentSceneValue = document.getElementById(
                "choose_transfer_scene"
            ).value;

            document
                .getElementById("choose_transfer_scene")
                .addEventListener("change", function () {
                    currentSceneValue = this.value;
                    console.log("Selected value:", currentSceneValue);

                    switch (currentSceneValue) {
                        case "low":
                            suffix = "_low";
                            break;
                        case "medium":
                            suffix = "_medium";
                            break;
                        case "high":
                            suffix = "_high";
                            break;
                        default:
                            suffix = "";
                            break;
                    }

                    sceneName = sheet + suffix;
                    console.log(suffix);
                    console.log("Current scene name: " + sceneName);
                });

            // 在切换选项卡之后保持非失真算法的默认选项不变
            $('a[data-toggle="tab"]').on("shown.bs.tab", function (e) {
                console.log("defaultOption: " + defaultOption);
                setDefaultOption(defaultOption);
            });

            document
                .getElementById("choose_template_sheet")
                .addEventListener("change", function () {
                    sheet = this.value;
                    sceneName = sheet + suffix;
                    console.log("Selected template:", sheet);
                    console.log("Current scene name: " + sceneName);
                });

            document
                .getElementById("showTemplate")
                .addEventListener("click", function () {
                    // 清空
                    // document.getElementById("fileInfo").innerHTML = "";
                    // document.getElementById("table_list").innerHTML = ""
                    // document.getElementById("table_list2").innerHTML = ""

                    if (sheet === "111") {
                        alert("请选择有效的场景");
                        return;
                    }
                    document.getElementById("table_body").innerHTML = "";
                    // 拼接html
                    let headers = [
                        "编号",
                        "字段缩写",
                        "字段名",
                        "字段类型",
                    ];

                    fetch("/" + sheet + suffix + "param/list")
                        .then(response => {
                            if (response.status !== 200) {
                                throw Error("Failed to get params");
                            } else {
                                return response.json();
                            }
                        })
                        .then(data => {
                            console.log(data.length);
                            let table = generateTable(data, headers, false);
                            $("#table_body").empty().append(table);
                            $("#table2").DataTable({
                                    pageLength: 25,  // 设置默认显示的行数为 10
                                    lengthMenu: [25, 50, 100]  // 设置每页显示行数的选项
                                }
                            )
                        })
                        .catch((error) => alert(error));

                    console.log("sheet:" + sheet);
                    // let xhr = new XMLHttpRequest();
                    // xhr.onreadystatechange = function () {
                    //     if (xhr.status === 200 && xhr.readyState === 4) {
                    //         let data_str = xhr.responseText;
                    //         let data = JSON.parse(data_str);
                    //         console.log(data.length);
                    //
                    //         html +=
                    //             // '<div class="table-responsive">' +
                    //             '<table class="table table-striped">' +
                    //             "<thead>" +
                    //             "<tr>" +
                    //             "<th>编号</th>" +
                    //             "<th>字段缩写</th>" +
                    //             "<th>字段名</th>" +
                    //             "<th>字段类型</th>" +
                    //             /*  "<th>脱敏算法</th>" +
                    //                       "<th>隐私保护等级</th>" +*/
                    //             "</tr>" +
                    //             "</thead>" +
                    //             '<tbody id="table2">';
                    //         for (let i = 0; i < data.length; i++) {
                    //             s = data[i];
                    //             //console.log(s)
                    //             html += "<tr id = " + "row_" + i + ">";
                    //             html += "<td>" + s.id + "</td>";
                    //             html += "<td>" + s.fieldName + "</td>";
                    //             html += "<td>" + s.columnName + "</td>";
                    //             html += "<td>";
                    //             switch (s.dataType) {
                    //                 case 0:
                    //                     html += "数值型数据";
                    //                     break;
                    //                 case 1:
                    //                     html += "编码型数据";
                    //                     break;
                    //                 case 3:
                    //                     html += "文本型数据";
                    //                     break;
                    //                 case 4:
                    //                     html += "时间数据";
                    //                     break;
                    //             }
                    //             html += "</td>";
                    //             html += "</tr>";
                    //         }
                    //         document.getElementById("table_body").innerHTML = html;
                    //     }
                    // };
                    //
                    // console.log("sheet: " + sheet + suffix);
                    // xhr.open("get", "/" + sheet + suffix + "param/list", false);
                    // xhr.send();
                    // document.getElementById("table_body").innerHTML = html;
                });
            document
                .getElementById("setTemplate")
                .addEventListener("click", function () {
                    // 清空
                    // document.getElementById("fileInfo").innerHTML = "";
                    // document.getElementById("table_list").innerHTML = "";
                    // document.getElementById("table_list2").innerHTML = "";
                    let sheet = $("#choose_template_sheet").val();
                    document.getElementById("table_body").innerHTML = "";
                    // 拼接html
                    let html = "";
                    console.log("Set Template sheet: " + sheet + suffix);
                    let headers = [
                        "编号",
                        "字段缩写",
                        "字段名",
                        "字段类型",
                        "脱敏算法",
                        "隐私保护等级"
                    ];

                    fetch("/" + sheet + suffix + "param/list")
                        .then(response => {
                            if (response.status !== 200) {
                                throw Error("Failed to get params");
                            } else {
                                return response.json();
                            }
                        })
                        .then(data => {
                            console.log(data.length);
                            let table = generateTable(data, headers);
                            $("#table_body").empty().append(table);
                            $("#table2").DataTable({
                                    pageLength: 25,  // 设置默认显示的行数为 10
                                    lengthMenu: [25, 50, 100]  // 设置每页显示行数的选项
                                }
                            )

                        })
                        .catch((error) => alert(error));

                });

            // 需求模板
            document
                .getElementById("fileUpload")
                .addEventListener("change", (event) => {
                    choose_file(event);
                });

            function getCurrentPageConfig(table) {
                let tr;
                let dataArray = [];
                if (!table) {
                    alert("请先设置模板参数");
                    return;
                }
                for (let i = 1; i < table.rows.length; i++) {
                    data = {};
                    tr = table.rows[i];
                    //console.log(tr);
                    data.id = tr.childNodes[0].innerHTML;
                    data.fieldName = tr.childNodes[1].innerHTML;
                    data.columnName = tr.childNodes[2].innerHTML;
                    data.dataType = typeFieldOptions[tr.childNodes[3].innerHTML];
                    data.k = Number.parseInt(tr.childNodes[4].firstChild.value);
                    data.tmParam = Number.parseInt(tr.childNodes[5].firstChild.value);
                    dataArray.push(JSON.stringify(data));
                    //console.log(dataArray);
                }
                console.log(dataArray);
                return dataArray;
            }

            document.getElementById("submitExcelParams").onclick = function () {

                let table = document.getElementById("table2");
                let dataArray = getCurrentPageConfig(table);

                let formData = new FormData();
                formData.set("tableName", sceneName);
                formData.set("params", JSON.stringify(dataArray));
                console.log("Scenename in formData: " + sceneName);
                console.log(dataArray.length);

                //构建formData,发送给后端

                fetch("/File/saveExcelParams", {
                    method: "POST",
                    body: formData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 200) {
                            alert("保存模板参数成功")
                        } else {
                            alert("保存模板参数失败")
                            throw new Error(data.msg)
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error)
                        alert(error)
                    });
            };

            // 1. 动态生成表头
            function generateTableHead(data) {
                // 获取 JSON 数据中的所有键名（作为列名）
                let columns = Object.keys(data[0]);
                // 生成表头的 HTML 结构
                let headerHtml = '<tr>';
                columns.forEach(col => {
                    headerHtml += `<th>${col}</th>`;
                });
                headerHtml += '</tr>';
                return headerHtml;
            }

            // 2. 转换 JSON 数据的键名为 DataTables 所需的 columns 格式
            function getDataTableColumns(data) {
                return Object.keys(data[0]).map(key => ({title: key, data: key}));
            }

            // 3. 初始化 DataTables 并使用 JSON 数据
            // function initializeDataTable(data) {
            //     let columns = getDataTableColumns(data);  // 获取列配置
            //     $('#jsonTable').DataTable({
            //         data: data,  // 使用 JSON 数据作为表格数据源
            //         columns: columns,  // 使用动态生成的列配置
            //         paging: true,  // 启用分页
            //         searching: true,  // 启用搜索
            //         ordering: true  // 启用排序
            //     });
            // }

            document.getElementById("submit").onclick = function () {

                let table_body = document.getElementById("table2");
                let dataArray = getCurrentPageConfig(table_body);

                if (!selectedFile) {
                    alert("请选择文件");
                    return;
                }

                let formData = new FormData();
                formData.set("file", selectedFile);
                formData.set("sheet", sceneName);
                formData.set("algName", "distortion");
                formData.set("params", JSON.stringify(dataArray));
                console.log("Scenename in formData: " + sceneName);
                console.log(dataArray.length);

                //构建formData,发送给后端

                fetch("/File/desenFile", {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => {
                        if (response.status === 500) {
                            // Handle server error
                            return response.text().then(failedMsg => {
                                alert(failedMsg);
                                throw new Error(failedMsg); // Throw an error to stop further processing
                            });
                        }
                        return response.blob();
                    })
                    .then((blob) => {
                        // 脱敏后
                        document.getElementById("afterData").innerHTML = "脱敏后数据";
                        const reader1 = new FileReader();
                        reader1.onload = function (event) {
                            const data = new Uint8Array(event.target.result);
                            const workbook = XLSX.read(data, {type: "array"});
                            const sheetName = workbook.SheetNames[0];
                            const sheet = workbook.Sheets[sheetName];
                            const jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1});
                            let pageSize = 10;
                            let pageCount = Math.ceil((jsonData.length - 1) / pageSize);
                            let currentPage1 = 1;

                            function displayTable1(page1) {
                                let startIndex1 = (page1 - 1) * pageSize + 1; // 跳过表头
                                let endIndex = Math.min(
                                    startIndex1 + pageSize,
                                    jsonData.length
                                );

                                let tableContent1 = "<thead><tr>";
                                let headers1 = jsonData[0];
                                headers1.forEach(function (header1) {
                                    tableContent1 +=
                                        '<th style="white-space: nowrap;">' + header1 + "</th>";
                                });
                                tableContent1 += "</tr></thead><tbody>";

                                for (let i = startIndex1; i < endIndex; i++) {
                                    tableContent1 += "<tr>";
                                    for (let j = 0; j < headers1.length; j++) {
                                        let cellValue =
                                            jsonData[i][j] !== undefined ? jsonData[i][j] : "";
                                        tableContent1 += "<td>" + cellValue + "</td>";
                                    }
                                    tableContent1 += "</tr>";
                                }

                                tableContent1 += "</tbody>";

                                $("#dataTable1").html(tableContent1);
                            }

                            displayTable1(currentPage1);

                            function renderPagination1() {
                                let pagination1 =
                                    '<li class="page-item"><a class="page-link" href="#" data-page="prev1">Prev</a></li>';
                                pagination1 +=
                                    '<li class="page-item"><a class="page-link" href="#" data-page="next1">Next</a></li>';

                                $("#pagination1").html(pagination1);

                                $("#pagination1 a")
                                    .off("click")
                                    .on("click", function (e) {
                                        e.preventDefault();
                                        let page = $(this).data("page");
                                        console.log(page);
                                        if (page === "prev1") {
                                            currentPage1 = Math.max(1, currentPage1 - 1);
                                        } else if (page === "next1") {
                                            currentPage1 = Math.min(pageCount, currentPage1 + 1);
                                        }
                                        displayTable1(currentPage1);
                                        $("#totalPages1").text(currentPage1 + "/" + pageCount);
                                        // renderPagination1();
                                    });

                                $("#totalPages1").text(currentPage1 + "/" + pageCount);
                            }

                            $("#paginationContainer1").show();
                            renderPagination1();

                            $("#goToPage1")
                                .off("click")
                                .on("click", function () {
                                    let pageNumber1 = parseInt($("#pageInput1").val());
                                    if (pageNumber1 >= 1 && pageNumber1 <= pageCount) {
                                        console.log(pageCount);
                                        currentPage1 = pageNumber1;
                                        displayTable1(currentPage1);
                                        renderPagination1();
                                    } else {
                                        alert("请输入有效页数！");
                                    }
                                });
                            // const data = new Uint8Array(event.target.result);
                            // const workbook = XLSX.read(data, {type: "array"});
                            // const sheet = workbook.Sheets[workbook.SheetNames[0]];
                            // const jsonData = XLSX.utils.sheet_to_json(sheet);
                            // const headers = Object.keys(jsonData[0]);
                            // console.log("headers:" + headers);
                            // let headerHtml = generateTableHead(jsonData);
                            // $("#dataTable1 thead").html(headerHtml);
                            // let columns = getDataTableColumns(jsonData);
                            // $("#dataTable1").DataTable({
                            //     data: jsonData,
                            //     columns: columns,
                            //     pageLength: 10,  // 设置默认显示的行数为 10
                            //     lengthMenu: [10, 25, 50, 100]  // 设置每页显示行数的选项
                            // })
                        };
                        reader1.readAsArrayBuffer(blob);

                        // 创建一个下载链接
                        const downloadLink = document.createElement("a");
                        downloadLink.href = URL.createObjectURL(blob);
                        downloadLink.download = Date.now().toString() + ".xlsx"; // 下载的文件名
                        downloadLink.click();
                        // after.appendChild(downloadLink);
                    })
                    .catch((error) => console.error("Error:", error));
            };

            // document.getElementById('submitDirectory').onclick = () => {
            //     const files = Array.from(document.getElementById('fileDirUpload').files);
            //     if (files.length === 0) {
            //         alert("请先选择文件夹");
            //         return;
            //     }
            //     let tr;
            //     let dataArray = [];
            //     let table_body = document.getElementById("table2");
            //     if (!table_body) {
            //         alert("请先设置模板参数");
            //         return;
            //     }
            //     for (let i = 0; i < table_body.rows.length; i++) {
            //         let data = {};
            //         tr = table_body.rows[i];
            //         //console.log(tr);
            //         data.id = tr.childNodes[0].innerHTML;
            //         data.fieldName = tr.childNodes[1].innerHTML;
            //         data.columnName = tr.childNodes[2].innerHTML;
            //         data.dataType = tr.childNodes[3].firstChild.value;
            //
            //         data.k = tr.childNodes[4].firstChild.value;
            //         data.tmParam = tr.childNodes[5].firstChild.value;
            //         dataArray.push(JSON.stringify(data));
            //         //console.log(dataArray);
            //     }
            //     let dataArrayJsonString = JSON.stringify(dataArray);
            //     // 筛选出以 .xlsx 结尾的文件
            //     const filteredFiles = files.filter(file => file.name.endsWith('.xlsx'));
            //
            //     const maxParallelUploads = 1; // 每次并行上传的文件数
            //     let fileQueue = [...filteredFiles];
            //
            //     function uploadFile(file) {
            //         console.log("Uploading file:", file.name);
            //         return new Promise((resolve, reject) => {
            //             const formData = new FormData();
            //             formData.set("file", file);
            //             formData.set("sheet", sceneName); // 这里替换为实际的 sceneName
            //             formData.set("algName", "distortion");
            //             formData.set("params", dataArrayJsonString); // 这里替换为实际的 params
            //
            //             fetch("/File/bigExcelDesen", {
            //                 method: "POST",
            //                 body: formData,
            //             })
            //                 .then(response => {
            //                     if (response.status === 500) {
            //                         return response.text().then(failedMsg => {
            //                             alert(failedMsg);
            //                             throw new Error(failedMsg); // Throw an error to stop further processing
            //                         });
            //                     }
            //                     return response.blob();
            //                 })
            //                 .then(blob => {
            //                     if (blob.size === 0) {
            //                         const errorMsg = "Received empty response from the server for file: " + file.name;
            //                         alert(errorMsg);
            //                         throw new Error(errorMsg); // Throw an error to stop further processing
            //                     }
            //                     // Proceed with blob processing if not empty
            //                     console.log("Blob received for file:", file.name);
            //                     // 创建一个下载链接
            //                     const downloadLink = document.createElement("a");
            //                     downloadLink.href = URL.createObjectURL(blob);
            //                     downloadLink.download = Date.now().toString() + ".xlsx"; // 下载的文件名
            //                     downloadLink.click();
            //                     resolve(); // Mark this file as successfully uploaded
            //                 })
            //                 .catch(error => {
            //                     console.error("Error uploading file:", file.name, error);
            //                     reject(error); // Reject the promise on error
            //                 });
            //         });
            //     }
            //
            //     function processQueue() {
            //         if (fileQueue.length === 0) return;
            //
            //         const currentBatch = fileQueue.splice(0, maxParallelUploads);
            //         const uploadPromises = currentBatch.map(file => uploadFile(file));
            //
            //         Promise.all(uploadPromises)
            //             .then(() => {
            //                 console.log('一批文件上传完成');
            //                 processQueue(); // 继续处理队列中的下一批文件
            //             })
            //             .catch(error => {
            //                 console.error('上传过程中出现错误', error);
            //             });
            //     }
            //
            //     processQueue(); // 开始处理队列
            // }

            function choose_file(event) {
                //读取文件
                selectedFile = event.target.files[0];
                // 文件名，扩展名
                const fileName = selectedFile.name;
                const fileExtension = fileName.split(".").pop().toLowerCase();

                if (selectedFile) {
                    if ("xlsx" === fileExtension) {
                        console.log("Selected file:", selectedFile);
                        console.log(fileExtension);
                        // 这里可以执行其他操作，例如显示文件名或预览文件

                        document.getElementById("fileInfo").innerHTML = '<div  style="font-size: 20px; text-align: center"> <span>' +
                            "<strong>" +
                            fileName +
                            "文件</strong>已选择" +
                            "</span>" +
                            "</div>";
                        // 脱敏前
                        document.getElementById("preData").innerHTML = "脱敏前数据";
                        let reader = new FileReader();
                        reader.onload = function (e) {
                            let data = new Uint8Array(e.target.result);
                            let workbook = XLSX.read(data, {type: "array"});

                            let sheetName = workbook.SheetNames[0];
                            let sheet = workbook.Sheets[sheetName];

                            let jsonData = XLSX.utils.sheet_to_json(sheet, {header: 1});

                            let pageSize = 10;
                            let pageCount = Math.ceil((jsonData.length - 1) / pageSize);
                            let currentPage = 1;

                            function displayTable(page) {
                                let startIndex = (page - 1) * pageSize + 1; // 跳过表头
                                let endIndex = Math.min(
                                    startIndex + pageSize,
                                    jsonData.length
                                );

                                let tableContent = "<thead><tr>";
                                let headers = jsonData[0];
                                headers.forEach(function (header) {
                                    tableContent +=
                                        '<th style="white-space: nowrap;">' + header + "</th>";
                                });
                                tableContent += "</tr></thead><tbody>";

                                for (let i = startIndex; i < endIndex; i++) {
                                    tableContent += "<tr>";
                                    for (let j = 0; j < headers.length; j++) {
                                        let cellValue =
                                            jsonData[i][j] !== undefined ? jsonData[i][j] : "";
                                        tableContent += "<td>" + cellValue + "</td>";
                                    }
                                    tableContent += "</tr>";
                                }

                                tableContent += "</tbody>";

                                $("#dataTable").html(tableContent);
                            }

                            displayTable(currentPage);

                            function renderPagination() {
                                let pagination =
                                    '<li class="page-item"><a class="page-link" href="#" data-page="prev">Prev</a></li>';
                                pagination +=
                                    '<li class="page-item"><a class="page-link" href="#" data-page="next">Next</a></li>';

                                $("#pagination").html(pagination);

                                $("#pagination a")
                                    .off("click")
                                    .on("click", function (e) {
                                        e.preventDefault();
                                        let page = $(this).data("page");
                                        console.log(page);
                                        if (page === "prev") {
                                            currentPage = Math.max(1, currentPage - 1);
                                        } else if (page === "next") {
                                            currentPage = Math.min(pageCount, currentPage + 1);
                                        }
                                        displayTable(currentPage);
                                        $("#totalPages").text(currentPage + "/" + pageCount);
                                        // renderPagination();
                                    });

                                $("#totalPages").text(currentPage + "/" + pageCount);
                            }

                            $("#paginationContainer").show();
                            renderPagination();

                            $("#goToPage")
                                .off("click")
                                .on("click", function () {
                                    let pageNumber = parseInt($("#pageInput").val());
                                    if (pageNumber >= 1 && pageNumber <= pageCount) {
                                        console.log(pageCount);
                                        currentPage = pageNumber;
                                        displayTable(currentPage);
                                        renderPagination();
                                    } else {
                                        alert("请输入有效页数！");
                                    }
                                });
                        };
                        reader.readAsArrayBuffer(selectedFile);
                    } else {
                        alert("请提交excel文件");
                    }
                } else {
                    document.getElementById("fileInfo").innerHTML = "";
                }
            }

            // 非失真脱敏相关
            let nondistortionPreviewFile = document.getElementById("preview-btn");
            let nondistortionUploadFile = document.getElementById("submit-btn");
            let nonDistortionFile = "";
            let nonDistortionFileName = "";

            function nondistortion_choose_file(event) {
                // 清空
                document.getElementById("nonDistortionFileInfo").innerHTML = "";
                document.querySelector(".raw-csv").style.display = "none";
                document.querySelector(".result-csv").style.display = "none";

                //读取文件
                if (nonDistortionFile !== event.target.files[0]) {
                    nonDistortionFile = event.target.files[0];
                    nonDistortionFileName = nonDistortionFile.name;
                }

                // 文件名，扩展名
                if (nonDistortionFile) {
                    const fileExtension = nonDistortionFileName
                        .split(".")
                        .pop()
                        .toLowerCase();
                    if (fileExtension !== "csv") {
                        alert("请上传csv文件");
                        return;
                    }
                    const fileName = nonDistortionFile.name;
                    let fileLoad =
                        '<div  style="font-size: 20px; text-align: center"> <span>' +
                        "<strong>" +
                        fileName +
                        "文件</strong>已选择" +
                        "</span>" +
                        "</div>";
                    console.log(fileName);
                    document.getElementById("nonDistortionFileInfo").innerHTML =
                        fileLoad;

                    console.log(fileExtension);

                    nondistortionUploadFile.disabled = false;
                    nondistortionPreviewFile.disabled = false;
                }
            }

            function previewCsv(file) {
                Papa.parse(file, {
                    complete: function (results) {
                        const data = results.data;
                        displayTable(data, 1);
                        setupPagination(data);
                    },
                    header: true,
                });
            }

            function uploadCsvFile(csvFile) {
                let formData = new FormData();
                formData.set("file", csvFile);
                fetch("/encryptMedical/receiveMedicalCsv", {
                    method: "POST",
                    body: formData,
                })
                    .then((response) => response.json())
                    .then((content) => {
                        if (content.status === "error") {
                            alert(content.data);
                        } else {
                            // 处理字节数组的CSV文件内容
                            const binaryData = atob(content.data); // Base64解码
                            const byteArray = new Uint8Array(binaryData.length);
                            for (let i = 0; i < binaryData.length; i++) {
                                byteArray[i] = binaryData.charCodeAt(i);
                            }
                            const csvContent = new TextDecoder("utf-8").decode(byteArray);
                            // 使用PapaParse解析CSV内容
                            const parsedData = Papa.parse(csvContent, {
                                header: true,
                            });

                            console.log(parsedData);

                            // 获取最后一列
                            const lastColumnHeader =
                                parsedData.meta.fields[parsedData.meta.fields.length - 1];
                            const lastColumnData = parsedData.data.map(
                                (row) => row[lastColumnHeader]
                            );

                            // 显示在前端界面
                            displayLastColumn(lastColumnData);

                            // 启用下载按钮
                            const downloadButton = $("#download-result-btn");
                            downloadButton.prop("disabled", false);
                            downloadButton
                                .off("click")
                                .on("click", () =>
                                    downloadCsv(csvContent, Date.now() + "_processed_file.csv")
                                );
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        alert(error);
                    });
            }

            nondistortionPreviewFile.addEventListener("click", () => {
                previewCsv(nonDistortionFile);
            });
            nondistortionUploadFile.addEventListener("click", () => {
                uploadCsvFile(nonDistortionFile);
            });

            function displayLastColumn(data, pageSize = 10) {
                let resultContainer = document.querySelector(".result-csv");
                let paginationContainer = document.getElementById(
                    "desenFilePaginationContainer"
                );

                let totalPages = Math.ceil(data.length / pageSize);
                let currentPage = 1;

                function renderTable(page) {
                    let startIndex = (page - 1) * pageSize;
                    let endIndex = Math.min(startIndex + pageSize, data.length);
                    let rows = "";
                    for (let i = startIndex; i < endIndex; i++) {
                        rows += "<tr><td>" + data[i] + "</td></tr>";
                    }
                    document.getElementById("desen-csv-tbody").innerHTML = rows;
                    resultContainer.style.display = "block";
                    updatePaginationInfo();
                }

                function updatePaginationInfo() {
                    document.getElementById("desenFilePaginationInfo").textContent =
                        "Page " + currentPage + " of " + totalPages;
                }

                function renderPaginationNonDistortion() {
                    document.getElementById("desenFilePrevPage").onclick = function (
                        event
                    ) {
                        event.preventDefault();
                        if (currentPage > 1) {
                            currentPage--;
                            renderTable(currentPage);
                            document.getElementById("desenFilePageInput").value =
                                currentPage;
                        }
                    };

                    document.getElementById("desenFileNextPage").onclick = function (
                        event
                    ) {
                        event.preventDefault();
                        if (currentPage < totalPages) {
                            currentPage++;
                            renderTable(currentPage);
                            document.getElementById("desenFilePageInput").value =
                                currentPage;
                        }
                    };

                    document.getElementById("desenFilePageInput").onchange =
                        function () {
                            let page = parseInt(this.value);
                            if (page >= 1 && page <= totalPages) {
                                currentPage = page;
                                renderTable(currentPage);
                            } else {
                                alert("请输入有效页数！");
                            }
                        };

                    document.getElementById("desenFilePageInput").value = currentPage;
                    paginationContainer.style.display = "flex";
                }

                renderTable(currentPage);
                renderPaginationNonDistortion();
            }

            // 设置默认算法
            $("#setDefaultAlgorithm").on("click", function (e) {
                let postData = new URLSearchParams();
                let transferScene = $("#choose_transfer_scene").val();
                let template = $("#choose_template_sheet").val();
                postData.set("toolsetName", "excel");
                postData.set("defaultAlgName", template + "_" + transferScene);
                console.log("postData: " + postData);

                fetch("/toolset/setDefaultToolset", {
                    method: "POST",
                    body: postData,
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.code === 200) {
                            alert("设置默认算法成功！");
                            defaultOption = template + "_" + transferScene;
                        } else {
                            throw new Error("设置默认算法失败！");
                        }
                    })
                    .catch((error) => {
                        alert(error);
                        console.log(error);
                    })
            });

            // document.getElementById('fileDirUpload').addEventListener('change', function (event) {
            //     const files = event.target.files;
            //     const allowedExtensions = ['.xlsx']; // 需要筛选的文件后缀
            //
            //     const filteredFiles = Array.from(files).filter(file => {
            //         return allowedExtensions.some(extension => file.name.endsWith(extension));
            //     });
            //     console.log(filteredFiles.length)
            //     // 输出筛选后的文件列表
            //     filteredFiles.forEach(file => {
            //         console.log(file.name);
            //     });
            //
            //     // 如果需要进一步处理筛选后的文件，可以在这里编写逻辑
            // });

            function displayTable(data, page, pageSize = 10) {
                const startIndex = (page - 1) * pageSize;
                const endIndex = Math.min(startIndex + pageSize, data.length);

                const headers = Object.keys(data[0]);

                let thead = "<tr>";
                headers.forEach((header) => {
                    thead += "<th>" + header + "</th>";
                });
                thead += "</tr>";

                let tbody = "";
                for (let i = startIndex; i < endIndex; i++) {
                    tbody += "<tr>";
                    headers.forEach((header) => {
                        tbody +=
                            "<td>" +
                            (data[i][header] !== undefined ? data[i][header] : "") +
                            "</td>";
                    });
                    tbody += "</tr>";
                }

                document.getElementById("csv-thead").innerHTML = thead;
                document.getElementById("csv-tbody").innerHTML = tbody;
                document.querySelector(".raw-csv").style.display = "block";
            }

            function setupPagination(data, pageSize = 10) {
                let totalPages = Math.ceil(data.length / pageSize);
                let currentPage = 1;
                const paginationContainer = document.getElementById(
                    "nonDistortionPagination"
                );

                function updatePaginationInfo() {
                    document.getElementById("nonDistortionPaginationInfo").textContent =
                        "Page " + currentPage + " of " + totalPages;
                }

                document.getElementById("nonDistortionPrevPage").onclick = function (
                    event
                ) {
                    event.preventDefault();
                    if (currentPage > 1) {
                        currentPage--;
                        displayTable(data, currentPage, pageSize);
                        document.getElementById("nonDistortionPageInput").value =
                            currentPage;
                        updatePaginationInfo();
                    }
                };

                document.getElementById("nonDistortionNextPage").onclick = function (
                    event
                ) {
                    event.preventDefault();
                    if (currentPage < totalPages) {
                        currentPage++;
                        displayTable(data, currentPage, pageSize);
                        document.getElementById("nonDistortionPageInput").value =
                            currentPage;
                        updatePaginationInfo();
                    }
                };

                document.getElementById("nonDistortionPageInput").onchange =
                    function () {
                        let page = parseInt(this.value);
                        if (page >= 1 && page <= totalPages) {
                            currentPage = page;
                            displayTable(data, currentPage, pageSize);
                            updatePaginationInfo();
                        } else {
                            alert("请输入有效页数！");
                        }
                    };

                document.getElementById("nonDistortionPageInput").value = currentPage;
                displayTable(data, currentPage, pageSize);
                updatePaginationInfo();
                paginationContainer.style.display = "flex";
            }

            function downloadCsv(content, fileName) {
                let blob = new Blob([content], {type: "text/csv;charset=utf-8;"});
                let link = document.createElement("a");
                let url = URL.createObjectURL(blob);

                link.setAttribute("href", url);
                link.setAttribute("download", fileName);
                link.style.visibility = "hidden";
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            document.getElementById("nonDistortionFileUpload").onchange = (
                event
            ) => {
                nondistortion_choose_file(event);
            };
        };
    </script>

    <style>
        .tabs-container ul {
            height: 70px;
            display: flex;
            flex-direction: row;
            justify-content: center;
        }

        /* 设置表格样式 */
        #dataTableContainer {
            width: 100%;
            overflow-x: auto;
        }

        #dataTable {
            width: 100%;
            margin: 0 auto;
        }

        #paginationInfo1,
        #paginationInfo {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        #paginationInfo1 input,
        #paginationInfo2 input,
        #paginationInfo3 input,
        #paginationInfo input {
            width: 5em;
            text-align: center;
        }

        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pagination-container ul {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: 10px;
        }

        #desenFilePagination {
            margin-right: auto; /* 推动至左端 */
        }

        #desenFilePaginationInfo {
            margin-left: auto; /* 推动至右端 */
        }

        /* 设置表格样式 */
        #dataTableContainer1 {
            width: 100%;
            overflow-x: auto;
        }

        #dataTable1 {
            width: 100%;
            margin: 0 auto;
        }

        .btn2 > button {
            background-color: #347aa9;
            padding: 5px 20px;
            cursor: pointer;
            color: black;
            font-size: 20px;
            display: inline-block;
            text-align: center;
            /*margin-right: 50px;*/
        }

        .btn2 {
            line-height: 30px;
            text-align: center;
            display: flex;
            justify-content: center;
        }

        /*选择框居中*/
        .midtile {
            line-height: 30px;
            text-align: center;
            display: flex;
            justify-content: center;
        }

        /*上传按钮*/
        #uploadForm > button,
        .upload-btn {
            background-color: #347aa9;
            color: white;
            cursor: pointer;
            padding: 5px 20px;
            text-align: center;
            font-size: 20px;
            display: inline-block;
            margin: 30px;
        }

        .fixed-width {
            width: 200px;
        }

        th {
            text-align: center;
        }
    </style>
</head>
<body>
<div class="row">
    <div class="col-sm-12">
        <div class="ibox float-e-margins">
            <div class="ibox-title"></div>

            <div class="tabs-container">
                <ul id="tab-type" class="nav nav-tabs" style="font-size: 20px">
                    <li class="active">
                        <a data-toggle="tab" href="#tab-1" aria-expanded="true">
                            失真
                        </a>
                    </li>
                    <li class="">
                        <a data-toggle="tab" href="#tab-2" aria-expanded="false">
                            非失真
                        </a>
                    </li>
                </ul>
                <div class="tab-content">
                    <div
                            id="tab-1"
                            class="tab-pane active"
                            style="text-align: center"
                    >
                        <form class="form-horizontal">
                            <div class="form-group">
                                <label for="choose_transfer_scene" style="font-size: 20px"
                                >选择流转场景</label
                                >
                                <select
                                        name="transfer_scene"
                                        id="choose_transfer_scene"
                                        style="font-size: 20px; text-align: center"
                                >
                                    <option value="111" selected>请选择流转场景</option>
                                    <option value="low">用户本地</option>
                                    <option value="medium">同机构不同系统</option>
                                    <option value="high">不同机构不同系统</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="choose_template_sheet" style="font-size: 20px"
                                >应用场景模板选择</label
                                >
                                <select
                                        name="template_sheet"
                                        id="choose_template_sheet"
                                        style="font-size: 20px; text-align: center"
                                >
                                    <option value="111" selected>请选择应用场景</option>
                                    <option value="map">地图导航类场景</option>
                                    <option value="onlinetaxi">网络约车类场景</option>
                                    <option value="communication">即时通信场景</option>
                                    <option value="community">网络社区类场景</option>
                                    <option value="onlinepayment">网络支付类场景</option>
                                    <option value="onlineshopping">网上购物类场景</option>
                                    <option value="transportationticket">交通票务类场景</option>
                                    <option value="marry">婚恋相亲类场景</option>
                                    <option value="employment">求职招聘类场景</option>
                                    <option value="onlinelending">网络借贷类场景</option>
                                    <option value="house">房屋租售类场景</option>
                                    <option value="usedcar">二手车交易类场景</option>
                                    <option value="consultation">问诊挂号类场景</option>
                                    <option value="travel">旅游服务类场景</option>
                                    <option value="hotel">酒店服务类场景</option>
                                    <option value="express">邮件快件寄递类场景</option>
                                    <option value="game">网络游戏类场景</option>
                                    <option value="education">学习教育类场景</option>
                                    <option value="locallife">本地生活类场景</option>
                                    <option value="woman">女性健康类场景</option>
                                    <option value="usecar">用车服务类场景</option>
                                    <option value="investment">投资理财类场景</option>
                                    <option value="bank">手机银行类场景</option>
                                    <option value="mailbox">邮箱云盘类场景</option>
                                    <option value="meeting">远程会议类场景</option>
                                    <option value="webcast">网络直播类场景</option>
                                    <option value="takeaway">餐饮外卖类场景</option>
                                    <option value="onlinemovie">在线影音类场景</option>
                                    <option value="shortvideo">短视频类场景</option>
                                    <option value="news">新闻资讯类场景</option>
                                    <option value="sports">运动健身类场景</option>
                                    <option value="browser">浏览器类场景</option>
                                    <option value="input">输入法类场景</option>
                                    <option value="security">安全管理类场景</option>
                                    <option value="ebook">电子图书类场景</option>
                                    <option value="capture">拍摄美化类场景</option>
                                    <option value="appstore">应用商店类场景</option>
                                    <option value="tools">实用工具类场景</option>
                                    <option value="performanceticket">演出票务类场景</option>
                                    <option value="networkaccess">
                                        电话/有线电视入网类场景
                                    </option>
                                    <option value="telecommunication">
                                        电信业务使用类场景
                                    </option>
                                    <option value="monitor">安防监控类场景</option>
                                    <option value="pay">生活缴费类场景</option>
                                    <option value="customerservice">客服类场景</option>
                                    <option value="schoolservice">校园服务类场景</option>
                                    <option value="smarthome">智慧家居类场景</option>
                                    <option value="autonomousdriving">自动驾驶类场景</option>
                                    <option value="telemedicine">远程诊疗类场景</option>
                                    <option value="vr">虚拟现实类场景</option>
                                    <option value="onlinevoting">网上投票类场景</option>
                                    <option value="homerepair">家庭维修类场景</option>
                                    <option value="petcare">宠物照顾类场景</option>
                                    <!--<#&#45;&#45;                                    <option value="telecomclient">电信客户信息类数据</option>&ndash;&gt;-->

                                </select>
                            </div>
                            <button
                                    type="button"
                                    class="btn btn-sm btn-primary upload-btn"
                                    id="showTemplate"
                            >
                                场景模板展示
                            </button>
                            <button
                                    type="button"
                                    class="btn btn-sm btn-primary upload-btn"
                                    id="setTemplate"
                            >
                                设置需求模板
                            </button>
                            <div class="form-group" id="uploadForm">
                                <input type="file" id="fileUpload" accept=".xlsx" style="display: none"/>
                                <label for="fileUpload" class="upload-btn">
                                    选择文件
                                </label>
<!--                                <input type="file" id="fileDirUpload" webkitdirectory multiple style="display: none"/>-->
<!--                                <label for="fileDirUpload" class="upload-btn m-l">选择文件夹</label>-->
                                <button type="button" class="btn btn-sm btn-primary m-l" id="submitExcelParams">
                                    保存模板参数
                                </button>
                            </div>

                            <div class="btn2">
                                <button type="button" class="btn btn-sm btn-primary" id="submit">提交脱敏</button>
                                <!--                                <button type="button" class="btn btn-sm btn-primary m-l" id="submitDirectory">-->
                                <!--                                    脱敏文件夹-->
                                <!--                                </button>-->

                                <button type="button" class="btn btn-sm btn-primary m-l" id="setDefaultAlgorithm">
                                    设置当前算法为默认算法
                                </button>
                            </div>
                        </form>

                        <!--文件上传信息-->
                        <div id="fileInfo"></div>
                        <div id="after"></div>
                        <div class="ibox-content">
                            <div id="table_body" class="table-responsive">

                            </div>
                        </div>

                        <div class="table-area">
                            <div>
                                <span id="preData" class="center-text"></span>
                            </div>
                            <div id="dataTableContainer" class="table-responsive">
                                <table id="dataTable" class="table table-bordered">
                                    <!-- 这里将用 JavaScript 动态创建表格内容 -->
                                    <thead></thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                            <div
                                    id="paginationContainer"
                                    class="mt-3"
                                    style="display: none"
                            >
                                <nav>
                                    <div
                                            id="paginationInfo"
                                            class="d-flex justify-content-between align-items-center"
                                    >
                                        <ul class="pagination mb-0" id="pagination"></ul>
                                        <div class="form-group mb-0 text-center">
                                            <label for="pageInput">跳转至：</label>
                                            <input
                                                    type="number"
                                                    class="form-control"
                                                    id="pageInput"
                                                    min="1"
                                            />
                                            <button class="btn btn-primary mt-2" id="goToPage">
                                                跳转
                                            </button>
                                        </div>
                                        <div id="totalPages"></div>
                                    </div>
                                </nav>
                            </div>
                            <div>
                                <span id="afterData" class="center-text"></span>
                            </div>
                            <div id="dataTableContainer1" class="table-responsive">
                                <table id="dataTable1" class="table table-bordered">
                                    <thead></thead>
                                    <tbody></tbody>
                                    <!-- 这里将用 JavaScript 动态创建表格内容 -->
                                </table>
                            </div>
                            <div
                                    id="paginationContainer1"
                                    class="mt-3"
                                    style="display: none"
                            >
                                <nav>
                                    <div
                                            id="paginationInfo1"
                                            class="d-flex justify-content-between align-items-center"
                                    >
                                        <ul class="pagination mb-0" id="pagination1"></ul>
                                        <div class="form-group mb-0 text-center">
                                            <label for="pageInput1">跳转至：</label>
                                            <input
                                                    type="number"
                                                    class="form-control"
                                                    id="pageInput1"
                                                    min="1"
                                            />
                                            <button class="btn btn-primary mt-2" id="goToPage1">
                                                跳转
                                            </button>
                                        </div>
                                        <div id="totalPages1"></div>
                                    </div>
                                </nav>
                            </div>
                        </div>
                    </div>
                    <div id="tab-2" class="tab-pane">
                        <div class="row">
                            <table style="margin: auto; font-size: 20px">
                                <thead>
                                <tr>
                                    <th>请选择表格非失真脱敏算法</th>
                                </tr>
                                </thead>
                                <tbody id="table1">
                                <tr>
                                    <td>
                                        <select id="nondistortionexcel_algName">
                                            <option value="linearsvm" selected>
                                                医疗数据加密查询算法
                                            </option>
                                        </select>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row">
                            <div class="midtile">
                                <div class="col-sm-5 m-b-xs">
                                    <form
                                            action="/upload"
                                            method="post"
                                            enctype="multipart/form-data"
                                    >
                                        <input
                                                type="file"
                                                id="nonDistortionFileUpload"
                                                accept=".csv"
                                                style="display: none"
                                        />
                                        <label for="nonDistortionFileUpload" class="upload-btn">
                                            选择将要上传的csv文件
                                        </label>
                                    </form>
                                </div>
                            </div>

                            <div id="nonDistortionFileInfo"></div>
                        </div>

                        <div class="container">
                            <div class="row text-center">
                                <div class="col-sm-offset-3 col-sm-2">
                                    <button
                                            type="button"
                                            class="btn btn-sm btn-primary upload-btn"
                                            id="preview-btn"
                                            disabled
                                    >
                                        预览文件
                                    </button>
                                </div>
                                <div class="col-sm-2">
                                    <button
                                            type="button"
                                            class="btn btn-sm btn-primary upload-btn"
                                            id="submit-btn"
                                            disabled
                                    >
                                        提交脱敏
                                    </button>
                                </div>
                                <div class="col-sm-2">
                                    <button
                                            type="button"
                                            class="btn btn-sm btn-primary upload-btn"
                                            id="download-result-btn"
                                            disabled
                                    >
                                        下载脱敏后文件
                                    </button>
                                </div>
                            </div>

                            <!--                            <#&#45;&#45; 显示原始医疗数据&ndash;&gt; <#&#45;&#45;-->
                            <!--                  <div class="row raw-csv" style="display: none">-->
                            <!--                    &ndash;&gt; <#&#45;&#45;-->
                            <!--                    <div class="col-md-12">-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                      <h3>原始医疗数据</h3>-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                      <div id="preview-container" class="table-bordered">-->
                            <!--                        &ndash;&gt; <#&#45;&#45;-->
                            <!--                        <table id="csv-table" class="table table-striped">-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                          <thead id="csv-thead"></thead>-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                          <tbody id="csv-tbody"></tbody>-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                        </table>-->
                            <!--                        &ndash;&gt; <#&#45;&#45;-->
                            <!--                        <nav aria-label="Page navigation">-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                          <ul-->
                            <!--                            class="pagination"-->
                            <!--                            id="nonDistortionPagination"-->
                            <!--                          ></ul>-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                        </nav>-->
                            <!--                        &ndash;&gt; <#&#45;&#45;-->
                            <!--                      </div>-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                    </div>-->
                            <!--                    &ndash;&gt; <#&#45;&#45;-->
                            <!--                  </div>-->
                            <!--                  &ndash;&gt; <#&#45;&#45;-->
                            <!--                  <div class="row result-csv" style="display: none">-->
                            <!--                    &ndash;&gt; <#&#45;&#45;-->
                            <!--                    <div class="col-sm6">-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                      <h3>脱敏后的医疗数据</h3>-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                      <div id="result-container" class="table-bordered">-->
                            <!--                        &ndash;&gt; <#&#45;&#45;-->
                            <!--                        <table id="csv-table" class="table table-striped">-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                          <thead id="desen-csv-thead" class="fixed-width">-->
                            <!--                            <th>查询结果</th>-->
                            <!--                          </thead>-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                          <tbody-->
                            <!--                            id="desen-csv-tbody"-->
                            <!--                            class="fixed-width"-->
                            <!--                          ></tbody>-->
                            <!--                          &ndash;&gt; <#&#45;&#45;-->
                            <!--                        </table>-->
                            <!--                        &ndash;&gt; <#&#45;&#45;-->
                            <!--                      </div>-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                      <nav-->
                            <!--                        aria-label="Page navigation"-->
                            <!--                        id="desenFilePaginationContainer"-->
                            <!--                        &#45;&#45;-->
                            <!--                      >-->
                            <!--                        <#&#45;&#45; style="display: none;">&ndash;&gt; <#&#45;&#45;-->
                            <!--                        <ul class="pagination" id="desenFilePagination"></ul>-->
                            <!--                        &ndash;&gt; <#&#45;&#45;-->
                            <!--                      </nav>-->
                            <!--                      &ndash;&gt; <#&#45;&#45;-->
                            <!--                    </div>-->
                            <!--                    &ndash;&gt; <#&#45;&#45;-->
                            <!--                  </div>-->
                            <!--                  &ndash;&gt;-->

                            <div class="row raw-csv" style="display: none">
                                <div class="col-md-12">
                                    <h3>原始医疗数据</h3>
                                    <div id="preview-container" class="table-bordered">
                                        <table id="csv-table" class="table table-striped">
                                            <thead id="csv-thead"></thead>
                                            <tbody id="csv-tbody"></tbody>
                                        </table>
                                    </div>
                                    <div class="pagination-container">
                                        <nav aria-label="Page navigation">
                                            <ul
                                                    class="pagination"
                                                    id="nonDistortionPagination"
                                                    style="display: flex"
                                            >
                                                <li class="page-item">
                                                    <a
                                                            class="page-link"
                                                            href="#"
                                                            aria-label="Previous"
                                                            id="nonDistortionPrevPage"
                                                    >
                                                        <span aria-hidden="true">&laquo;</span>
                                                    </a>
                                                </li>
                                                <li class="page-item">
                                                    <input
                                                            type="number"
                                                            id="nonDistortionPageInput"
                                                            class="form-control"
                                                            style="width: 70px"
                                                            min="1"
                                                    />
                                                </li>
                                                <li class="page-item">
                                                    <a
                                                            class="page-link"
                                                            href="#"
                                                            aria-label="Next"
                                                            id="nonDistortionNextPage"
                                                    >
                                                        <span aria-hidden="true">&raquo;</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </nav>
                                        <div id="nonDistortionPaginationInfo"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="row result-csv" style="display: none">
                                <div class="col-sm-12">
                                    <h3>脱敏后的医疗数据</h3>
                                    <div id="result-container" class="table-bordered">
                                        <table class="table table-striped">
                                            <thead id="desen-csv-thead" class="fixed-width">
                                            <th>查询结果</th>
                                            </thead>
                                            <tbody
                                                    id="desen-csv-tbody"
                                                    class="fixed-width"
                                            ></tbody>
                                        </table>
                                    </div>
                                    <div
                                            class="pagination-container"
                                            id="desenFilePaginationContainer"
                                    >
                                        <nav aria-label="Page navigation">
                                            <ul class="pagination" id="desenFilePagination">
                                                <li class="page-item">
                                                    <a
                                                            class="page-link"
                                                            href="#"
                                                            aria-label="Previous"
                                                            id="desenFilePrevPage"
                                                    >
                                                        <span aria-hidden="true">&laquo;</span>
                                                    </a>
                                                </li>
                                                <li class="page-item">
                                                    <input
                                                            type="number"
                                                            id="desenFilePageInput"
                                                            class="form-control"
                                                            style="width: 70px"
                                                            min="1"
                                                    />
                                                </li>
                                                <li class="page-item">
                                                    <a
                                                            class="page-link"
                                                            href="#"
                                                            aria-label="Next"
                                                            id="desenFileNextPage"
                                                    >
                                                        <span aria-hidden="true">&raquo;</span>
                                                    </a>
                                                </li>
                                            </ul>
                                        </nav>
                                        <div id="desenFilePaginationInfo"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>
